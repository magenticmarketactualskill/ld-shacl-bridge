# ld-shacl-bridge

A Ruby Sinatra application that converts JSON to JSON-LD, generates SHACL shapes, and manages frames with a many-to-many relationship.

## Features

- **JSON to JSON-LD Conversion**: Automatically converts plain JSON to JSON-LD using provided context
- **SHACL Shape Generation**: Generates SHACL constraint shapes from JSON-LD structure
- **Frame Management**: Stores and retrieves frames with associated SHACL shapes
- **Many-to-Many Relationships**: Supports multiple frames sharing SHACL shapes and vice versa
- **RESTful API**: Clean HTTP API for all operations

## Requirements

- Ruby 3.3.6
- SQLite 3
- Bundler

## Installation

1. Clone or extract the application:
```bash
cd ld-shacl-bridge
```

2. Install dependencies:
```bash
bundle install
```

3. Set up the database:
```bash
bundle exec rake db:migrate
```

## Running the Application

Start the server:
```bash
bundle exec ruby app.rb
```

The application will be available at `http://localhost:4567`

Or use Puma:
```bash
bundle exec puma
```

## API Endpoints

### Health Check
```
GET /
```
Returns the service status.

### Convert JSON to JSON-LD
```
PUT /convert
Headers:
  Context: <JSON-LD context URL>
  Id: <Frame identifier>
Body: JSON object
```

Converts JSON to JSON-LD, generates SHACL shape, and stores both with their relationship.

**Example:**
```bash
curl -X PUT http://localhost:4567/convert \
  -H "Content-Type: application/json" \
  -H "Context: https://schema.org/" \
  -H "Id: person-frame-1" \
  -d '{
    "name": "John Doe",
    "email": "john@example.com",
    "age": 30
  }'
```

**Response:**
```json
{
  "@context": "http://ld-shacl-bridge.org/shacl/<uuid>",
  "@id": "http://ld-shacl-bridge.org/frame/person-frame-1",
  "name": "John Doe",
  "email": "john@example.com",
  "age": 30
}
```

### Retrieve Frame
```
GET /frame/:id
```

Retrieves a frame by its ID along with associated SHACL shape IDs.

**Example:**
```bash
curl http://localhost:4567/frame/person-frame-1
```

**Response:**
```json
{
  "frame_id": "person-frame-1",
  "context": "https://schema.org/",
  "shacl_ids": ["<uuid>"],
  "created_at": "2024-12-11T13:20:00Z"
}
```

### Retrieve SHACL Shape
```
GET /shacl/:id
```

Retrieves a SHACL shape by its UUID along with associated frame IDs.

**Example:**
```bash
curl http://localhost:4567/shacl/<uuid>
```

**Response:**
```json
{
  "shacl_id": "<uuid>",
  "shape": "@prefix sh: <http://www.w3.org/ns/shacl#> ...",
  "frame_ids": ["person-frame-1"],
  "created_at": "2024-12-11T13:20:00Z"
}
```

## Testing

Run the test suite:
```bash
bundle exec rspec
```

Run with documentation format:
```bash
bundle exec rspec --format documentation
```

## Architecture

### Components

- **JsonLdConverter**: Handles JSON to JSON-LD conversion
- **ShaclGenerator**: Generates SHACL shapes from JSON-LD
- **Database Models**:
  - `Frame`: Stores frame information
  - `Shacl`: Stores SHACL shapes
  - `FramesShacl`: Join table for many-to-many relationship

### Database Schema

**frames**
- `id`: Primary key
- `frame_id`: Unique frame identifier (from Id header)
- `context`: JSON-LD context URL
- `created_at`: Timestamp

**shacls**
- `id`: Primary key
- `shacl_id`: UUID v7 identifier
- `shape`: SHACL shape in Turtle format
- `created_at`: Timestamp

**frames_shacls**
- `frame_id`: Foreign key to frames
- `shacl_id`: Foreign key to shacls

## UML Diagrams

The `docs/` directory contains UML diagrams:
- `use_case_diagram.png`: System use cases
- `sequence_diagram.png`: Conversion workflow sequence
- `class_diagram.png`: Application class structure
- `er_diagram.png`: Database entity relationships

## Technology Stack

- **Ruby**: 3.3.6
- **Framework**: Sinatra 4.1
- **Database**: SQLite with Sequel ORM
- **RDF Processing**: RDF.rb, JSON-LD gem
- **SHACL**: SHACL gem
- **Testing**: RSpec
- **UUID**: UUID7 gem

## License

This application is provided as-is for demonstration and development purposes.

## Author

Generated by Manus AI
